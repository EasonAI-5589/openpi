# Pi0.5 ManiSkill è¯„ä¼°é—®é¢˜è®°å½• (2024-12-28, æ›´æ–° 2024-12-29)

## é—®é¢˜æ¦‚è¿°

**PickCube ä»»åŠ¡è¯„ä¼°æˆåŠŸç‡ä¸º 0%**

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| æˆåŠŸç‡ | 0/50 = **0%** |
| æ¯ä¸ª episode | è·‘æ»¡ 500 æ­¥è¶…æ—¶ |
| å¹³å‡æ—¶é—´ | 11.79s/episode |

## è®­ç»ƒæƒ…å†µï¼ˆæ­£å¸¸ï¼‰

è®­ç»ƒæœ¬èº«æ­£å¸¸å®Œæˆï¼š

| Step | Loss | Grad Norm |
|------|------|-----------|
| 0 | 0.0833 | 0.8746 |
| 29900 | 0.0045 | 0.0526 |

- Loss ä¸‹é™ **95%**ï¼ˆ0.0833 â†’ 0.0045ï¼‰
- è®­ç»ƒæ—¶é•¿ï¼š9å°æ—¶46åˆ†
- Checkpointï¼š`checkpoints/pi05_maniskill_pickcube/pickcube_sft_v1/29999`

## é—®é¢˜æ’æŸ¥

### 1. wrist_image å…¨é»‘ âš ï¸

è¯„ä¼°æ—¶ `wrist_image` æ˜¯å…¨é»‘å›¾åƒï¼š

![base_image](../debug_images/base_image.jpg) - æ­£å¸¸
![wrist_image](../debug_images/wrist_image.jpg) - **å…¨é»‘**

**åŸå› **ï¼šè¯„ä¼°ç¯å¢ƒæ²¡æœ‰é…ç½® `hand_camera`ï¼Œä»£ç å›é€€åˆ°é›¶å›¾åƒ

```python
# eval_maniskill.py:120-122
if wrist is not None:
    inputs["observation/wrist_image"] = np.asarray(wrist)
else:
    # Use a zero image fallback - è¿™é‡Œè¿”å›å…¨é»‘
    inputs["observation/wrist_image"] = np.zeros((h, w, 3), dtype=np.uint8)
```

**è®­ç»ƒæ•°æ®æœ‰ wrist_image**ï¼š
```
Columns: ['image', 'wrist_image', 'state', 'actions', ...]
```

### 2. action_horizon é…ç½®å·®å¼‚ âš ï¸

| é…ç½®é¡¹ | æˆ‘ä»¬ (Pi0.5 PickCube) | äº‘å¸† (Pi0 StackCube) |
|--------|----------------------|---------------------|
| action_horizon | **10** | **20** |
| data_config | LeRobotManiskillNoWristDataConfig | LeRobotManiskillDataConfig |
| batch_size | 128 | 256 |
| fsdp_devices | 8 | 1 (é»˜è®¤) |

è¯„ä¼°è„šæœ¬ä¸­ `max_actions_to_execute = 20`ï¼Œä½†æ¨¡å‹è¾“å‡ºå¯èƒ½åªæœ‰ 10 ä¸ª actionsã€‚

### 3. äº‘å¸†çš„è¯„ä¼°ç»“æœå¯¹æ¯”

äº‘å¸† StackCube æœ€æ–°ç»“æœï¼š
- **25 success / 91 total â‰ˆ 27.5%**

è¯´æ˜ä»–çš„è®­ç»ƒå’Œè¯„ä¼°æµç¨‹æ˜¯æœ‰æ•ˆçš„ã€‚

## äº‘å¸† PickCube ç»“æœï¼ˆå¯¹æ¯”ï¼‰

~~äº‘å¸†ç”¨ **Pi0**ï¼ˆé Pi0.5ï¼‰è®­ç»ƒçš„ PickCubeï¼š~~

| æŒ‡æ ‡ | å€¼ |
|------|-----|
| ~~Success~~ | ~~37~~ |
| ~~Failure~~ | ~~163~~ |
| ~~**æˆåŠŸç‡**~~ | ~~**18.5%**~~ |

> âš ï¸ **2024-12-29 æ›´æ–°**ï¼šä¸Šè¿° 18.5% æˆåŠŸç‡**æœªèƒ½å¤ç°**ã€‚
> ä½¿ç”¨äº‘å¸†çš„ checkpoint é‡æ–°è¯„ä¼°ï¼Œç»“æœå‡ä¸º 0%ã€‚è¯¦è§ä¸‹æ–¹éªŒè¯ç»“æœã€‚

**äº‘å¸†é…ç½®**ï¼š
```python
TrainConfig(
    name="pi0_maniskill_pickcube",
    model=pi0_config.Pi0Config(action_horizon=10),  # Pi0, é Pi0.5
    data=LeRobotManiskillNoWristDataConfig(...),    # å’Œæˆ‘ä»¬ä¸€æ ·
    batch_size=256,
    ...
)
```

---

## 2024-12-29 éªŒè¯ç»“æœï¼ˆé‡è¦ï¼‰

### ä½¿ç”¨äº‘å¸† Checkpoint é‡æ–°è¯„ä¼°

| Task | Checkpoint è·¯å¾„ | æˆåŠŸç‡ | å‘½ä»¤ |
|------|----------------|--------|------|
| **StackCube** | `/share/project/yunfan/.../pi0_maniskill_stackcube/stackcube/9500` | **15% (3/20)** âœ… | è§ä¸‹æ–¹ |
| PickCube | `/share/project/yunfan/.../pi0_maniskill_pickcube/pickcube/26000` | **0% (0/20)** | - |
| PickCube_50 | `/share/project/yunfan/.../pi0_maniskill_pickcube_50/pickcube/29999` | **0% (0/20)** | - |

**æˆåŠŸçš„ StackCube è¯„ä¼°å‘½ä»¤**ï¼š
```bash
CUDA_VISIBLE_DEVICES=0 \
PYTHONPATH=/share/project/yunfan/RL/caurft/openpi/src:$PYTHONPATH \
python /share/project/yunfan/RL/caurft/openpi/scripts/eval_maniskill.py \
    --config-name pi0_maniskill_stackcube \
    --checkpoint-dir /share/project/yunfan/RL/caurft/openpi/checkpoints/pi0_maniskill_stackcube/stackcube/9500 \
    --env-id StackCube-v1 \
    --num-episodes 20 \
    --save-video False \
    --prompt "Pick up a red cube and stack it on top of a green cube and let go of the cube without it falling" \
    --sim-backend cpu
```

### wrist_image ä¸€è‡´æ€§éªŒè¯

**æ£€æŸ¥è®­ç»ƒæ•°æ®ä¸­çš„ wrist_image**ï¼š
```python
# è¯»å–è®­ç»ƒæ•°æ®
df = pd.read_parquet('.../maniskill_pickcube/.../episode_000000.parquet')
wrist = df['wrist_image'].iloc[0]
# ç»“æœï¼šwrist_image min=0, max=0, mean=0.00 â†’ å…¨é›¶ï¼
```

| æ£€æŸ¥é¡¹ | è®­ç»ƒæ•°æ® | è¯„ä¼°æ—¶ | ä¸€è‡´æ€§ |
|--------|----------|--------|--------|
| wrist_image | å…¨é›¶ | å…¨é›¶ | âœ… ä¸€è‡´ |

**ç»“è®º**ï¼šwrist_image ä¸æ˜¯é—®é¢˜æ ¹æºï¼è®­ç»ƒå’Œè¯„ä¼°éƒ½æ˜¯å…¨é›¶ã€‚

### äº‘å¸†è§†é¢‘ç›®å½•ç¡®è®¤

```bash
ls /share/project/yunfan/RL/caurft/openpi/video/ | grep PickCube
# ç»“æœï¼šå…¨éƒ¨æ˜¯ failure
PickCube-v1_ep1_failure.mp4
PickCube-v1_ep2_failure.mp4
...
PickCube-v1_ep20_failure.mp4
```

**ç»“è®º**ï¼šäº‘å¸†è‡ªå·±çš„ PickCube è¯„ä¼°ä¹Ÿå…¨éƒ¨å¤±è´¥ï¼Œä¸æˆ‘ä»¬çš„ç»“æœä¸€è‡´ã€‚

## å¯èƒ½åŸå› æ€»ç»“ï¼ˆ2024-12-29 æ›´æ–°ï¼‰

| å¯èƒ½åŸå›  | æ¦‚ç‡ | è¯´æ˜ | éªŒè¯ç»“æœ |
|----------|------|------|----------|
| ~~Pi0 vs Pi0.5 å·®å¼‚~~ | ~~é«˜~~ | ~~äº‘å¸†ç”¨ Pi0 æœ‰æ•ˆ~~ | âŒ äº‘å¸† Pi0 PickCube ä¹Ÿæ˜¯ 0% |
| ~~wrist_image è®­ç»ƒ/è¯„ä¼°ä¸ä¸€è‡´~~ | ~~ä¸­~~ | ~~è®­ç»ƒæœ‰å›¾ï¼Œè¯„ä¼°å…¨é»‘~~ | âŒ è®­ç»ƒæ•°æ®ä¹Ÿæ˜¯å…¨é›¶ |
| **PickCube ä»»åŠ¡æœ¬èº«éš¾** | **é«˜** | ç›¸æ¯” StackCube æ›´éš¾å­¦ä¹  | âœ… StackCube 15%, PickCube 0% |
| è®­ç»ƒæ­¥æ•°ä¸å¤Ÿ | ä¸­ | å¯èƒ½éœ€è¦æ›´å¤šè®­ç»ƒ | å¾…éªŒè¯ |
| ä»»åŠ¡ prompt ä¸åŒ¹é… | ä½ | prompt å¯èƒ½å½±å“æ•ˆæœ | å¾…éªŒè¯ |

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼ˆ2024-12-29 æ›´æ–°ï¼‰

### âœ… å·²å®Œæˆ
- [x] éªŒè¯è¯„ä¼°æµç¨‹ï¼ˆStackCube 15% æˆåŠŸï¼‰
- [x] æ’é™¤ wrist_image é—®é¢˜ï¼ˆè®­ç»ƒ/è¯„ä¼°éƒ½æ˜¯å…¨é›¶ï¼‰
- [x] æ’é™¤ Pi0 vs Pi0.5 é—®é¢˜ï¼ˆäº‘å¸† Pi0 PickCube ä¹Ÿæ˜¯ 0%ï¼‰

### ğŸ”„ è¿›è¡Œä¸­
1. ~~**é—®äº‘å¸†**ï¼š18.5% çš„ç»“æœæ˜¯æ€ä¹ˆè·‘å‡ºæ¥çš„ï¼Ÿ~~ âœ… å·²å›å¤ï¼ˆ19:50ï¼‰

### äº‘å¸†å›å¤å…³é”®ä¿¡æ¯

> "ä½ éœ€è¦å…ˆè®­ç»ƒä¸€ä¸ª pi0.5 ç„¶åæµ‹è¯•ä¸€ä¸‹"

**å…³é”®å‘ç°ï¼šStackCube å’Œ PickCube é…ç½®ä¸åŒï¼**

| ä»»åŠ¡ | action_horizon | data_config | æˆåŠŸç‡ |
|------|----------------|-------------|--------|
| **StackCube** | **20** | **LeRobotManiskillDataConfig**ï¼ˆå¸¦ wristï¼‰ | **15%** âœ… |
| PickCube | 10 | NoWristDataConfig | 0% |

è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆ StackCube èƒ½æˆåŠŸè€Œ PickCube å¤±è´¥ï¼

### ğŸ“‹ å»ºè®®æ–¹æ¡ˆ

#### æ–¹æ¡ˆ Aï¼šæ¢æˆ StackCube ä½œä¸ºåŸºå‡†ä»»åŠ¡ï¼ˆæ¨èï¼‰
StackCube å·²éªŒè¯å¯è¡Œï¼ˆ15%ï¼‰ï¼Œç”¨å®ƒæ¥éªŒè¯ Pi0.5 è®­ç»ƒæµç¨‹ã€‚

```bash
# Pi0.5 è®­ç»ƒ StackCube
uv run scripts/train.py --config pi05_maniskill_stackcube
```

#### æ–¹æ¡ˆ Bï¼šåˆ†æ PickCube vs StackCube å·®å¼‚
å¯¹æ¯”ä¸¤ä¸ªä»»åŠ¡çš„è®­ç»ƒæ•°æ®ã€åŠ¨ä½œåˆ†å¸ƒã€éš¾åº¦ï¼Œæ‰¾å‡º PickCube å¤±è´¥åŸå› ã€‚

#### ~~æ–¹æ¡ˆ Cï¼šä¿®å¤ wrist_image~~ï¼ˆå·²æ’é™¤ï¼‰
~~æ·»åŠ  hand_camera åˆ°è¯„ä¼°ç¯å¢ƒ~~ - ä¸éœ€è¦ï¼Œè®­ç»ƒæ•°æ®æœ¬èº«å°±æ˜¯å…¨é›¶ã€‚

## ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `src/openpi/training/config.py:L480` | PickCube è®­ç»ƒé…ç½® |
| `scripts/eval_maniskill.py:L98-122` | wrist_image å¤„ç†é€»è¾‘ |
| `debug_images/` | è¯„ä¼°æ—¶ä¿å­˜çš„è°ƒè¯•å›¾åƒ |
| `nohup.out` | è®­ç»ƒæ—¥å¿— |

## å‚è€ƒï¼šäº‘å¸†çš„æˆåŠŸé…ç½®

```python
TrainConfig(
    name="pi0_maniskill_stackcube",
    model=pi0_config.Pi0Config(action_horizon=20),  # æ³¨æ„æ˜¯ 20
    data=LeRobotManiskillDataConfig(  # å¸¦ wrist ç‰ˆæœ¬
        repo_id="...",
        base_config=DataConfig(prompt_from_task=True),
        extra_delta_transform=False,
    ),
    batch_size=256,
    ...
)
```
