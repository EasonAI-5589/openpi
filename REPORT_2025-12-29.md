# OpenPI 项目进度汇报

> 郭奕辰
> 汇报日期：2025-12-29
> 汇报对象：程洪洋、娄云帆

---

## 📅 汇报周期

**上次汇报（2025-12-27）**：环境配好，LIBERO Benchmark 跑通，ManiSkill3 数据格式问题待解决

**本次汇报（2025-12-29）**：ManiSkill3 数据准备完成，正在进行代码适配

---

## ✅ 核心进展

### 1. LIBERO Benchmark 验证完成

**目的**：验证环境配置和模型加载正确性

**结果**：
| Task Suite | 官方成绩 | 我们的成绩 | 状态 |
|------------|----------|-----------|------|
| libero_spatial | 98.8% | **96%** (48/50) | ✅ 接近论文 |

**结论**：环境配置正确，Pi0.5 模型加载无误

### 2. ManiSkill3 数据准备完成

**问题**：ManiSkill 使用 HDF5 格式，OpenPI 需要 LeRobot 格式

**解决方案**（已与云帆对接）：
- ✅ 参考云帆的数据转换脚本
- ✅ 完成 HDF5 → LeRobot 格式转换流程
- ✅ 转换全部 6 个任务数据：

| 任务 | 轨迹数 | 数据大小 | 状态 |
|------|--------|----------|------|
| StackCube | 200 | ~3.5GB | ✅ |
| PickCube | 200 | ~3.5GB | ✅ |
| PushCube | 200 | ~3.5GB | ✅ |
| PullCube | 200 | ~3.5GB | ✅ |
| PlaceSphere | 188 | ~3.3GB | ✅ |
| PegInsertionSide | 200 | ~3.5GB | ✅ |

**技术细节**：
- State 格式：复用 LIBERO 的 8D state (qpos[:8])
- 无手腕相机：wrist_image 填充 zeros
- 归一化统计：每个任务单独计算 norm_stats

### 3. Pi0.5 ManiSkill 代码适配进行中

**当前工作**：
- ✅ 创建 6 个任务的 Pi0.5 训练配置
- ✅ 适配 LeRobot 数据加载器
- 🔄 调试 Pi0.5 与 ManiSkill 的兼容性问题
- 🔄 优化训练参数配置

**技术挑战**：
- Pi0.5 模型内存占用较大，需要 FSDP 多卡分片
- LeRobot 数据格式与 ManiSkill 的适配细节调整
- 训练超参数需要针对 ManiSkill 任务调优

### 4. ManiSkill3 Zero-shot Baseline 评估

**目的**：建立 baseline，了解未微调模型的表现

| Task | Zero-shot 成功率 | 说明 |
|------|-----------------|------|
| StackCube-v1 | 0% | 符合预期 |
| PullCube-v1 | 0% | 符合预期 |
| PushCube-v1 | 0% | 符合预期 |
| PickCube-v1 | 0% | 符合预期 |
| PlaceSphere-v1 | 0% | 符合预期 |
| PegInsertionSide-v1 | 0% | 符合预期 |

**对比参考**（云帆 Pi0 微调后）：
- StackCube: 60%
- PullCube: 87.5%
- PushCube: 70%

**结论**：Zero-shot 0% 符合预期，证明需要在 ManiSkill 数据上进行微调

---

## 📊 当前状态总结

| 项目 | 状态 | 成果 |
|------|------|------|
| **环境配置** | ✅ 完成 | 商庄服务器部署完成 |
| **LIBERO Benchmark** | ✅ 完成 | 96% (接近论文 98.8%) |
| **ManiSkill 数据转换** | ✅ 完成 | 6 个任务全部转换 |
| **ManiSkill Zero-shot** | ✅ 完成 | 0% baseline 建立 |
| **Pi0.5 代码适配** | 🔄 进行中 | 训练配置调试中 |
| **ManiSkill 微调训练** | ⏳ 待开始 | 代码适配完成后启动 |

---

## 🎯 下一步计划

### 近期（本周内）

#### 1. 完成 Pi0.5 ManiSkill 代码适配
- 解决内存优化问题（FSDP 配置）
- 调试训练流程的兼容性
- 验证数据加载正确性

#### 2. 启动 ManiSkill 微调训练
- 先在单个任务（如 PickCube）上验证流程
- 确认训练可以正常收敛
- 验证成功后批量训练剩余任务

#### 3. 完成 ManiSkill Benchmark 评估
- 对比云帆的 Pi0 结果
- 分析 Pi0.5 相比 Pi0 的表现

### 中期计划

#### 4. 架构更改：Flow Matching 头
- 替换当前的 Diffusion 动作头
- 微调参数：当前 loss = diffusion loss + a + q loss
- 阅读 CRFT 论文（程洪洋推荐）

---

## 💡 关键发现

### 1. Pi0.5 在 LIBERO 上表现稳定
- **我们的结果**：96% (48/50)
- **论文报告**：98.8%
- **结论**：环境配置正确，模型加载无误

### 2. ManiSkill 数据转换方案可行
- 云帆的 HDF5 → LeRobot 转换方法可以复用
- State 格式（8D qpos[:8]）与 LIBERO 一致
- 无手腕相机不影响数据准备

### 3. Zero-shot 验证了微调的必要性
- Pi0.5 base 在 ManiSkill 上 0% 成功率
- 云帆的 Pi0 微调后达到 60-87% 成功率
- 证明了在 ManiSkill 数据上微调的重要性

---

## 🔧 技术架构

### ManiSkill3 集成流程

```
ManiSkill HDF5 数据
    ↓
convert_maniskill_data_to_lerobot.py (云帆方案)
    ↓
LeRobot 格式数据集
    ├── image: 256×256×3 RGB
    ├── wrist_image: zeros (无手腕相机)
    ├── state: 8D (qpos[:8])
    └── actions: 7D
    ↓
Pi0.5 训练配置
    ├── FSDP 多卡分片（解决内存问题）
    ├── Batch Size 调优
    └── Cosine LR Schedule
    ↓
[代码适配调试中...]
    ↓
ManiSkill 微调训练
    ↓
评估与跑分
```

### 环境配置

| 组件 | 版本/配置 | 状态 |
|------|----------|------|
| 服务器 | 商庄集群 | ✅ |
| GPU | H800 × 8 | ✅ |
| Python | 3.11 | ✅ |
| Pi0.5 Base | 14GB checkpoint | ✅ |
| LIBERO Checkpoint | 12GB | ✅ |
| ManiSkill 数据 | 6 个任务 ~20GB | ✅ |

---

## 📁 代码与资源

### 仓库地址
- **官方仓库**: https://github.com/Physical-Intelligence/openpi
- **我的 Fork**: https://github.com/EasonAI-5589/openpi
- **最新提交**: https://github.com/EasonAI-5589/openpi/commit/5a84b8c

### 关键文档
- `docs/TODO.md` - 任务清单
- `docs/QUESTIONS.md` - 待讨论问题
- `docs/MANISKILL_RESEARCH.md` - ManiSkill 集成研究
- `docs/YUNFAN_WORK_ANALYSIS.md` - 云帆方案分析
- `BENCHMARK_REPORT.md` - Benchmark 评估详情

### 数据位置
```
/share/project/guoyichen/maniskill_lerobot/
├── maniskill_stackcube/      # 200 轨迹
├── maniskill_pickcube/        # 200 轨迹
├── maniskill_pushcube/        # 200 轨迹
├── maniskill_pullcube/        # 200 轨迹
├── maniskill_placesphere/     # 188 轨迹
└── maniskill_peginsertionside/# 200 轨迹
```

---

## ❓ 待协调事项

### 技术问题

1. **FSDP 配置优化**
   - 8 卡内存分片的最优配置
   - Batch size 与显存占用的平衡

2. **训练超参数确认**
   - 学习率、warmup steps 等是否需要调整
   - 训练步数设置（参考云帆的经验）

3. **评估指标确认**
   - 除了成功率，还需要关注哪些指标？
   - 评估的 episode 数量标准

### 资源协调

1. **GPU 使用计划**
   - 6 个任务训练的 GPU 分配
   - 是否需要并行训练

2. **时间节点确认**
   - ManiSkill 微调训练的 deadline
   - Flow Matching 改造的优先级

---

## 📈 项目里程碑

```
✅ 2025-12-26: 环境配置完成
✅ 2025-12-27: LIBERO Benchmark 完成（96%）
✅ 2025-12-27: ManiSkill 数据转换完成
✅ 2025-12-27: ManiSkill Zero-shot 评估完成
🔄 2025-12-29: Pi0.5 ManiSkill 代码适配中
⏳ 2025-12-30: 代码适配完成，启动微调训练
⏳ 2026-01-03: ManiSkill Benchmark 完整跑分
⏳ TBD: Flow Matching 头改造
```

---

**总结**：上次汇报提到的 ManiSkill3 数据格式问题已通过与云帆对接解决，数据准备工作全部完成。LIBERO Benchmark 结果验证了环境配置的正确性。目前正在进行 Pi0.5 与 ManiSkill 的代码适配工作，主要解决内存优化和训练流程兼容性问题，完成后即可启动微调训练。
